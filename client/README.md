# Client specification

Client is a Common Lisp based replacement for HTML+CSS+JS.
It can be broken down into the following parts:

- hypertext;
- DOM;
- renderer;
- web objects.

## 1 Hypertext

### 1.1 General features

1. Hypertext is text with embedded Lisp code fragments.
2. Hypertext is parsed to build a DOM tree in memory.
3. Lisp code fragments are enclosed in <( )>. <(a ...)> is interpreted as (a ...).
4. The hypertext parser evals embedded Lisp fragments one by one as it encounters them.
5. Lisp code is eval'ed by the parser in a sandboxed environment.
6. Embedded Lisp code may contain instructions to the parser.

### 1.2 Parser instructions

These are the instructions the parser must support out of the box.
More complex instructions can be built from these as Lisp functions.

#### 1.2.1 Node

1. Node-opening instruction is <(@node *class* *properties-list*)>. The *class* parameter specifies class of the node to be constructed, as nodes are Lisp objects and it is possible to define custom nodes.
2. Node-closing instruction is <(node@)>.
3. The hypertext between the opening and closing instructions is parsed into a separate DOM node - essentially a sub-document.
4. A hypertext document may start with a <(@node ...)> instruction - in this case the node is interpereted as document root. 
   Otherwise, a root node is generated by the parser, and all the DOM elements are interpreted as its children.
5. <(@node ...)> arguments define node properties. Node properties are described in the DOM section.
6. Nodes may be nested.

#### 1.2.2 Conditional

1. <(@if *cond*)> starts a conditional block that will be parsed only if *cond* evaluates to true.
2. <(if@)> closes a conditional block.
3. Conditional blocks support nesting.
4. <(@else)> within a conditional block started with <(@if *cond*)> starts a part that will pe parsed if *cond* evaluates to false.
5. <(@elif *cond2*)> within a conditional block started with <(@if *cond*)> starts a part that will be parsed if *cond* is false and *cond2* is true.

#### 1.2.3 Loop

1. <(@loop *cond*)> starts a loop: a section of the document that will be retraversed by the parser in cycle while *cond* is true.
2. <(loop@)> closes the looped section.
3. Loops support nesting.
4. There must be a loop iterations number limit, reaching which generates an exceptional condition.
5. <(@break)> exits current loop.
6. <(@continue)> starts next iteration

### 1.3 Parser API

These are the functions available during parse time.

1. (thisnode) returns the DOM node whose content is currently being parsed.
2. (rootnode) returns the document root.







